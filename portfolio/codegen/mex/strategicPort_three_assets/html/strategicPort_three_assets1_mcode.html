<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">w_T</span> = <span class="message error" id="M1F1C">strategicPort_three_assets</span>(<span class="var type1" id="S3T2U6">sim_r</span>, <span class="var type1" id="S4T2U7">sim_br</span>, <span class="var type1" id="S5T3U8">sim_x</span>, <span class="var type1" id="S6T4U9">gamma</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="mxinfo " id="T4:U6">[<span class="var type1" id="S7T4U13">M</span>, <span class="var type1" id="S8T4U14">K</span>]   = size(<span class="var type1" id="S3T2U17">sim_r</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T4:U10"><span class="var type1" id="S10T4U20">aversion</span> = <span class="mxinfo " id="T4:U12"><span class="mxinfo " id="T4:U13">1</span>/(<span class="mxinfo " id="T4:U14"><span class="mxinfo " id="T4:U15">1</span>-<span class="var type1" id="S6T4U26">gamma</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T4:U17"><span class="var type1" id="S11T4U29">appetite</span> = <span class="mxinfo " id="T4:U19"><span class="mxinfo " id="T4:U20">1</span>/<span class="var type1" id="S10T4U32">aversion</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T2:U22"><span class="var type1" id="S12T2U35">e_sim_r</span>  = <span class="mxinfo " id="T2:U24">exp(<span class="var type1" id="S3T2U38">sim_r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T2:U26"><span class="var type1" id="S14T2U41">e_sim_br</span> = <span class="mxinfo " id="T2:U28">exp(<span class="var type1" id="S4T2U44">sim_br</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T5:U30"><span class="var type1" id="S15T5U47">U_fut</span>    = <span class="mxinfo " id="T5:U32">ones(<span class="var type1" id="S7T4U50">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T4:U34"><span class="var type1" id="S17T4U54">nports</span>   = <span class="mxinfo " id="T4:U36">101*101</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T1:U37"><span class="var type1" id="S2T1U60">w_T</span>      = <span class="mxinfo " id="T1:U39">ones(<span class="mxinfo " id="T4:U40">3</span>, <span class="var type1" id="S8T4U64">K</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T6:U42"><span class="var type1" id="S18T6U67">portfolios</span> = <span class="mxinfo " id="T6:U44">zeros(<span class="mxinfo " id="T4:U45">3</span>, <span class="var type1" id="S17T4U71">nports</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T7:U47"><span class="var type1" id="S20T7U74">U</span>        = <span class="mxinfo " id="T7:U49">ones(<span class="var type1" id="S7T4U77">M</span>, <span class="var type1" id="S17T4U78">nports</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">% create portfolios for grid search</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T4:U52"><span class="var type1" id="S21T4U81">w</span> = <span class="mxinfo " id="T4:U54">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S22T4U85">stock_weight</span> = <span class="mxinfo " id="T4:U56">0</span> : <span class="mxinfo " id="T4:U57">0.01</span> : 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S23T4U93">bond_weight</span> = <span class="mxinfo " id="T4:U59">0</span> : <span class="mxinfo " id="T4:U60">0.01</span> : 1</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo " id="T8:U61"><span class="var type1" id="S24T8U101">weights</span> = <span class="mxinfo " id="T8:U63">[<span class="var type1" id="S22T4U104">stock_weight</span>; <span class="var type1" id="S23T4U106">bond_weight</span>; <span class="mxinfo " id="T4:U66"><span class="mxinfo " id="T4:U67"><span class="mxinfo " id="T4:U68">1</span>-<span class="var type1" id="S22T4U111">stock_weight</span></span>-<span class="var type1" id="S23T4U112">bond_weight</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T8:U71"><span class="mxinfo " id="T8:U72"><span class="var type1" id="S18T6U116">portfolios</span>(<span class="mxinfo " id="T9:U74">:</span>, <span class="var type1" id="S21T4U118">w</span>)</span> = <span class="mxinfo " id="T8:U76"><span class="mxinfo " id="T8:U77">abs(<span class="var type1" id="S24T8U122">weights</span>)</span>/<span class="mxinfo " id="T4:U79">sum(<span class="mxinfo " id="T8:U80">abs(<span class="var type1" id="S24T8U127">weights</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T4:U82"><span class="var type1" id="S21T4U130">w</span> = <span class="mxinfo " id="T4:U84"><span class="var type1" id="S21T4U132">w</span> + <span class="mxinfo " id="T4:U86">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="comment">% compute wealths for each period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T10:U87"><span class="var type1" id="S27T10U136">log_wealth</span> = <span class="mxinfo " id="T10:U89">zeros(<span class="var type1" id="S7T4U139">M</span>, <span class="var type1" id="S17T4U140">nports</span>, <span class="var type1" id="S8T4U141">K</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T4:U93"><span class="var type1" id="S28T4U144">batchsize</span> = <span class="mxinfo " id="T4:U95">300</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T4U148">t</span> = <span class="mxinfo " id="T4:U97">1</span> : <span class="var type1" id="S8T4U151">K</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T11:U99"><span class="var type1" id="S30T11U154">returns</span> = <span class="mxinfo " id="T11:U101">[<span class="mxinfo " id="T5:U102"><span class="var type1" id="S12T2U158">e_sim_r</span>(<span class="mxinfo " id="T12:U104">:</span>, <span class="var type1" id="S29T4U160">t</span>)</span>, <span class="mxinfo " id="T5:U106"><span class="var type1" id="S14T2U162">e_sim_br</span>(<span class="mxinfo " id="T12:U108">:</span>, <span class="var type1" id="S29T4U164">t</span>)</span>, <span class="mxinfo " id="T5:U110">ones(<span class="var type1" id="S7T4U167">M</span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T7:U112"><span class="var type1" id="S31T7U171">wealths</span> = <span class="mxinfo " id="T7:U114"><span class="var type1" id="S30T11U173">returns</span> * <span class="var type1" id="S18T6U174">portfolios</span></span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S32T4U177">buffer</span> = <span class="mxinfo " id="T4:U118">1</span> : ceil(<span class="var type1" id="S17T4U183">nports</span>/<span class="var type1" id="S28T4U184">batchsize</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T13:U121"><span class="var type1" id="S34T13U187">batch</span> = <span class="mxinfo " id="T13:U123"><span class="mxinfo " id="T4:U124"><span class="mxinfo " id="T4:U125"><span class="var type1" id="S28T4U191">batchsize</span> * (<span class="mxinfo " id="T4:U127"><span class="var type1" id="S32T4U194">buffer</span>-<span class="mxinfo " id="T4:U129">1</span></span>)</span> + <span class="mxinfo " id="T4:U130">1</span></span> : <span class="mxinfo " id="T4:U131">min(<span class="mxinfo " id="T4:U132"><span class="var type1" id="S28T4U200">batchsize</span> * <span class="var type1" id="S32T4U201">buffer</span></span>, <span class="var type1" id="S17T4U202">nports</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo " id="T14:U136"><span class="mxinfo " id="T14:U137"><span class="var type1" id="S27T10U206">log_wealth</span>(<span class="mxinfo " id="T12:U139">:</span>,<span class="var type1" id="S34T13U208">batch</span>,<span class="var type1" id="S29T4U209">t</span>)</span> = <span class="mxinfo " id="T2:U142">exp(<span class="mxinfo " id="T14:U143"><span class="var type1" id="S11T4U213">appetite</span> .* <span class="mxinfo " id="T14:U145">log(<span class="mxinfo " id="T14:U146"><span class="var type1" id="S31T7U217">wealths</span>(<span class="mxinfo " id="T12:U148">:</span>,<span class="var type1" id="S34T13U219">batch</span>)</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T4U222">t</span> = <span class="mxinfo " id="T4:U151">1</span> : <span class="var type1" id="S8T4U225">K</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T4:U153"><span class="var type1" id="S37T4U228">N</span> = <span class="var type1" id="S29T4U229">t</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S38T4U232">period</span> = <span class="mxinfo " id="T4:U157"><span class="var type1" id="S37T4U236">N</span>-<span class="mxinfo " id="T4:U159">1</span></span>:<span class="mxinfo " id="T4:U160">-1</span>:<span class="mxinfo " id="T4:U161">1</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">        <span class="comment">% set returns</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">        <span class="mxinfo " id="T11:U162"><span class="var type1" id="S30T11U243">returns</span> = <span class="mxinfo " id="T11:U164">[<span class="mxinfo " id="T5:U165"><span class="var type1" id="S12T2U247">e_sim_r</span>(<span class="mxinfo " id="T12:U167">:</span>, <span class="var type1" id="S29T4U249">t</span>)</span>, <span class="mxinfo " id="T5:U169"><span class="var type1" id="S14T2U251">e_sim_br</span>(<span class="mxinfo " id="T12:U171">:</span>, <span class="var type1" id="S29T4U253">t</span>)</span>, <span class="mxinfo " id="T5:U173">ones(<span class="var type1" id="S7T4U256">M</span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">        <span class="comment">% compute wealth from portfolios</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S32T4U260">buffer</span> = <span class="mxinfo " id="T4:U176">1</span> : ceil(<span class="var type1" id="S17T4U266">nports</span>/<span class="var type1" id="S28T4U267">batchsize</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">            <span class="mxinfo " id="T13:U179"><span class="var type1" id="S34T13U270">batch</span> = <span class="mxinfo " id="T13:U181"><span class="mxinfo " id="T4:U182"><span class="mxinfo " id="T4:U183"><span class="var type1" id="S28T4U274">batchsize</span> * (<span class="mxinfo " id="T4:U185"><span class="var type1" id="S32T4U277">buffer</span>-<span class="mxinfo " id="T4:U187">1</span></span>)</span> + <span class="mxinfo " id="T4:U188">1</span></span> : <span class="mxinfo " id="T4:U189">min(<span class="mxinfo " id="T4:U190"><span class="var type1" id="S28T4U283">batchsize</span> * <span class="var type1" id="S32T4U284">buffer</span></span>, <span class="var type1" id="S17T4U285">nports</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">            <span class="mxinfo " id="T14:U194"><span class="mxinfo " id="T14:U195"><span class="var type1" id="S20T7U289">U</span>(<span class="mxinfo " id="T12:U197">:</span>,<span class="var type1" id="S34T13U291">batch</span>)</span> = <span class="mxinfo " id="T14:U199"><span class="var type1" id="S10T4U293">aversion</span> * (<span class="mxinfo " id="T14:U201"><span class="mxinfo " id="T14:U202"><span class="var type1" id="S27T10U297">log_wealth</span>(<span class="mxinfo " id="T12:U204">:</span>,<span class="var type1" id="S34T13U299">batch</span>,<span class="mxinfo " id="T4:U206"><span class="var type1" id="S38T4U301">period</span>+<span class="mxinfo " id="T4:U208">1</span></span>)</span> .* <span class="mxinfo " id="T14:U209">repmat(<span class="var type1" id="S15T5U305">U_fut</span>, 1, <span class="mxinfo " id="T4:U211">size(<span class="var type1" id="S34T13U309">batch</span>,2)</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        <span class="comment">% compute utility for weight pairs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo " id="T2:U213"><span class="var type1" id="S40T2U313">X</span> = <span class="mxinfo " id="T2:U215">[<span class="mxinfo " id="T5:U216">ones(<span class="var type1" id="S7T4U318">M</span>,1)</span> <span class="mxinfo " id="T2:U218"><span class="mxinfo " id="T2:U219">squeeze(<span class="mxinfo " id="T15:U220"><span class="var type1" id="S5T3U324">sim_x</span>(<span class="mxinfo " id="T12:U222">:</span>,<span class="var type1" id="S38T4U326">period</span>,<span class="mxinfo " id="T12:U224">:</span>)</span>)</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">        <span class="mxinfo " id="T7:U225"><span class="var type1" id="S42T7U330">beta</span> = <span class="mxinfo " id="T7:U227">(<span class="mxinfo " id="T2:U228"><span class="mxinfo " id="T2:U229"><span class="var type1" id="S40T2U335">X</span>'</span>*<span class="var type1" id="S40T2U336">X</span></span>)\(<span class="mxinfo " id="T7:U232"><span class="mxinfo " id="T2:U233"><span class="var type1" id="S40T2U340">X</span>'</span>*<span class="var type1" id="S20T7U341">U</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">        <span class="mxinfo " id="T7:U236"><span class="var type1" id="S43T7U344">U_cond</span> = <span class="mxinfo " id="T7:U238"><span class="var type1" id="S40T2U346">X</span>*<span class="var type1" id="S42T7U347">beta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">        <span class="comment">% select optimal portfolio</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">        [<span class="mxinfo " id="T4:U241">~</span>,<span class="var type1" id="S44T5U352">I</span>] = max(<span class="var type1" id="S43T7U355">U_cond</span>,[],2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">        <span class="mxinfo " id="T1:U244"><span class="var type1" id="S46T1U361">W_opt</span> = <span class="mxinfo " id="T1:U246"><span class="var type1" id="S18T6U363">portfolios</span>(<span class="mxinfo " id="T9:U248">:</span>,<span class="var type1" id="S44T5U365">I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">        <span class="comment">% update vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">        <span class="mxinfo " id="T5:U250"><span class="var type1" id="S15T5U368">U_fut</span> = <span class="mxinfo " id="T5:U252">(<span class="mxinfo " id="T5:U253"><span class="mxinfo " id="T5:U254">sum(<span class="mxinfo " id="T11:U255"><span class="var type1" id="S30T11U375">returns</span> .* <span class="mxinfo " id="T11:U257"><span class="var type1" id="S46T1U377">W_opt</span>'</span></span>, 2)</span>.^<span class="var type1" id="S11T4U379">appetite</span></span>) .*<span class="var type1" id="S15T5U380">U_fut</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">    <span class="comment">% solve for first period</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S32T4U383">buffer</span> = <span class="mxinfo " id="T4:U262">1</span> : ceil(<span class="var type1" id="S17T4U389">nports</span>/<span class="var type1" id="S28T4U390">batchsize</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo " id="T13:U265"><span class="var type1" id="S34T13U393">batch</span> = <span class="mxinfo " id="T13:U267"><span class="mxinfo " id="T4:U268"><span class="mxinfo " id="T4:U269"><span class="var type1" id="S28T4U397">batchsize</span> * (<span class="mxinfo " id="T4:U271"><span class="var type1" id="S32T4U400">buffer</span>-<span class="mxinfo " id="T4:U273">1</span></span>)</span> + <span class="mxinfo " id="T4:U274">1</span></span> : <span class="mxinfo " id="T4:U275">min(<span class="mxinfo " id="T4:U276"><span class="var type1" id="S28T4U406">batchsize</span> * <span class="var type1" id="S32T4U407">buffer</span></span>, <span class="var type1" id="S17T4U408">nports</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">        <span class="mxinfo " id="T14:U280"><span class="mxinfo " id="T14:U281"><span class="var type1" id="S20T7U412">U</span>(<span class="mxinfo " id="T12:U283">:</span>,<span class="var type1" id="S34T13U414">batch</span>)</span> = <span class="mxinfo " id="T14:U285"><span class="var type1" id="S10T4U416">aversion</span> * (<span class="mxinfo " id="T14:U287"><span class="mxinfo " id="T14:U288"><span class="var type1" id="S27T10U420">log_wealth</span>(<span class="mxinfo " id="T12:U290">:</span>,<span class="var type1" id="S34T13U422">batch</span>,<span class="mxinfo " id="T4:U292">1</span>)</span> .* <span class="mxinfo " id="T14:U293">repmat(<span class="var type1" id="S15T5U426">U_fut</span>, 1, <span class="mxinfo " id="T4:U295">size(<span class="var type1" id="S34T13U430">batch</span>,2)</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    <span class="comment">% compute utility for weight pairs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">    [<span class="mxinfo " id="T4:U297">~</span>,<span class="var type1" id="S44T4U436">I</span>] = max(<span class="mxinfo " id="T16:U299">mean(<span class="var type1" id="S20T7U441">U</span>, 1)</span>, [], 2);</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="mxinfo " id="T8:U301"><span class="var type1" id="S46T8U448">W_opt</span> = <span class="mxinfo " id="T8:U303"><span class="var type1" id="S18T6U450">portfolios</span>(<span class="mxinfo " id="T9:U305">:</span>,<span class="var type1" id="S44T4U452">I</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo " id="T8:U307"><span class="mxinfo " id="T8:U308"><span class="var type1" id="S2T1U456">w_T</span>(<span class="mxinfo " id="T9:U310">:</span>,<span class="var type1" id="S29T4U458">t</span>)</span> = <span class="var type1" id="S46T8U459">W_opt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    <span class="mxinfo " id="T5:U313"><span class="var type1" id="S15T5U462">U_fut</span>  = <span class="mxinfo " id="T5:U315">ones(<span class="var type1" id="S7T4U465">M</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">    fprintf(<span class="string">'Done %f period.\n'</span>, <span class="var type1" id="S29T4U471">t</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
